
1. 项目概述
1.1 项目背景
图像修复技术广泛应用于多个场景，包括：

低光照图像增强：夜景照片、室内暗光照片提亮
雾霾天气图像去雾：旅游照片、风景摄影除雾
老照片修复：颜色褪色、噪点去除、对比度恢复
日常照片美化：曝光不足、色彩暗淡的照片修复

常见的图像质量问题：

颜色偏移：照片发黄、发蓝、色彩不准
对比度低：画面灰蒙、不够清晰
噪声问题：照片有颗粒感、不够细腻
模糊问题：照片不够锐利、边缘模糊

这些应用场景并非孤立需求，而是共享「场景识别 → 图像预处理 → 参数调优 → 质量评估」的整体链路，只是调优策略不同。需要面向夜景、雾霾、老照片、日常照片等多类型影像提供统一的多场景修复能力。

1.2 项目目标
开发一套纯浏览器端的多场景图像修复工具，运行于Windows浏览器（Chrome/Edge），实现图像一键修复和手动调整功能。系统能够根据图像特点（如低光、雾霾、老照片等）自动切换策略，用户无需安装任何软件，仅需打开网页即可完成从上传、修复、对比到评估的完整流程。
1.3 核心特性

零安装：打开浏览器访问网页即可使用
隐私保护：图像完全在本地浏览器处理，不上传服务器
简单易用：拖拽上传、一键修复、实时预览
离线使用：首次访问后可离线使用（PWA技术）
多场景自适应：通过预设模板和参数探测，自动匹配低光、雾霾、老照片、日常照片等不同修复策略

1.4 典型使用场景

夜景/低光增强：针对暗光和噪点问题，突出亮度提升、动态范围压缩与保边去噪。
雾霾/去雾优化：通过暗通道去雾和大气光估计恢复清晰度，并强化对比度以突出层次。
老照片修复：围绕褪色情况进行色彩重映射、降噪和细节锐化，兼顾历史质感。
日常照片美化：对曝光不足或色彩暗淡的照片进行快速一键优化，提升观感并支持社交分享。


1. 系统架构设计
2.1 整体架构
采用纯前端架构，所有功能在浏览器端完成：
┌─────────────────────────────────────────┐
│         用户界面层（UI Layer）            │
│  - 图像上传  - 参数调整  - 结果展示      │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│       业务逻辑层（Service Layer）         │
│  - 图像预处理  - 修复流程控制            │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│    图像处理层（Processing Layer）         │
│  - Canvas API  - Web Workers             │
│  - 颜色校正  - 对比度增强  - 去噪        │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│       本地存储层（Storage Layer）         │
│  - IndexedDB  - LocalStorage             │
└─────────────────────────────────────────┘
2.2 技术栈选型（纯Web技术）
前端技术

框架：React 18 + TypeScript + Vite
路由：React Router DOM（多页面导航）
状态管理：Zustand（轻量级状态管理，替代复杂的Redux）
样式方案：Tailwind CSS + CSS Variables（快速构建UI）
UI组件：

Radix UI（无障碍组件：Slider/Dialog/Popover）
react-dropzone（拖拽上传）
react-image-comparison-slider（对比滑块）


图表展示：Apache ECharts（质量指标可视化）
本地存储：IndexedDB（存储图像和历史记录）

图像处理技术（纯浏览器API）

Canvas API：图像绘制和像素级操作
Web Workers：后台线程处理图像，避免卡顿
OffscreenCanvas：提升渲染性能
WebAssembly（可选）：加速复杂算法运算
File API：本地文件读取和保存

PWA技术（离线支持）

Service Worker：缓存资源，实现离线访问
Web App Manifest：添加到桌面快捷方式
Cache API：离线数据缓存


3. 功能模块详细设计
3.1 图像输入模块
3.1.1 功能需求

支持格式：JPG, PNG, WEBP（浏览器原生支持）
支持拖拽上传和点击选择
图像预览（显示文件名、大小、尺寸）
文件大小限制（建议10MB以内，确保流畅）

3.1.2 技术实现要点

使用 react-dropzone 实现拖拽上传
File API 读取本地图像为 Blob/DataURL
Canvas API 预览和缩放显示
IndexedDB 存储原始图像数据

3.1.3 用户交互设计
┌──────────────────────────────────┐
│   拖拽图片到这里                   │
│   或点击选择文件                   │
│   支持格式：JPG/PNG/WEBP           │
│   单张图片不超过10MB               │
└──────────────────────────────────┘
         ↓ 上传成功
┌──────────────────────────────────┐
│  [图片预览]                        │
│  文件名：vacation_photo.jpg        │
│  尺寸：1920x1080  大小：2.3MB      │
│  [一键修复] [手动调整]             │
└──────────────────────────────────┘
3.1.4 页面实现（upload.html）

页面结构：/upload 页面包含 UploadArea（拖拽区）、PreviewCard（预览卡片）、ActionButtons（操作按钮）
拖拽上传：react-dropzone 捕获文件，使用 File API 读取为 DataURL
图片预览：Canvas 绘制预览图，自动计算合适的显示尺寸
本地存储：使用 Zustand 管理当前图像状态，IndexedDB 保存原始数据
交互反馈：react-hot-toast 显示上传成功/失败提示


3.2 图像修复模块
3.2.1 核心算法组件（纯Canvas实现）
A. 颜色校正子模块
功能：修正照片色偏、恢复自然色彩
算法方案：

白平衡调整

灰度世界算法（Gray World）
RGB通道平衡


颜色补偿

色温调整（偏冷/偏暖）
饱和度增强


色调映射

伽马校正
曲线调整



可调参数：

色温调整：-50 ~ +50（暖色/冷色）
饱和度：0-200%（默认120%）
亮度：-50 ~ +50（默认0）

B. 对比度增强子模块
功能：提升照片清晰度和层次感
算法方案：

直方图处理

直方图均衡化
对比度拉伸


锐化增强

Unsharp Masking（反锐化掩模）
边缘增强


去雾处理（针对雾霾或场景）

暗通道先验算法（简化版）
大气光估计



可调参数：

对比度：0-200%（默认120%）
锐化强度：0-100%（默认50%）
去雾强度：0-100%（默认0，按需开启）

C. 去噪子模块
功能：减少照片颗粒感和噪点
算法方案：

基础去噪

均值滤波
高斯滤波


保边去噪

双边滤波（简化实现）
中值滤波



可调参数：

去噪强度：0-100%（默认30%）
细节保留：0-100%（默认70%）

3.2.2 修复流程设计
场景识别（亮度/色温/雾霾指数/噪声水平检测）
    ↓
参数推荐（匹配低光/雾霾/老照片/日常预设，可人工覆盖）
    ↓
原始图像（File API读取）
    ↓
转换到Canvas
    ↓
获取像素数据（ImageData）
    ↓
Web Worker处理
 ├─ [颜色校正] ← 参数
 ├─ [对比度增强] ← 参数
 └─ [去噪处理] ← 参数
    ↓
返回处理后的ImageData
    ↓
Canvas渲染显示
    ↓
用户预览/下载
3.2.3 智能模式与手动模式
一键修复模式：

自动分析图像特征（亮度、对比度、色彩分布）
应用预设的最佳参数组合
适合快速处理，不想调参数的用户

手动调整模式：

提供所有参数的滑块控制
实时预览效果（debounce优化，300ms延迟）
可一键切换多场景预设（如、夜景、雾霾、老照片、日常美化），并支持自行扩展
可保存常用预设

3.2.4 手动调整界面实现（adjustment.html）

布局：左侧原图+修复图对比预览，右侧参数面板
双图对比：使用两个Canvas并排显示，或使用对比滑块
实时调参：Radix UI Slider组件，onChange事件触发Web Worker重新处理
性能优化：

使用 lodash.debounce 延迟300ms处理
预览时降低分辨率（如缩小到800px宽度）
最终导出时使用原始分辨率


预设管理：

内置预设：照片、夜景、老照片、日常美化
自定义预设保存到LocalStorage
预设不仅保存滑块数值，还记录 type 标签，便于 IndexedDB/history 与场景统计联动




3.3 效果对比模块
3.3.1 对比展示方式
A. 左右分屏对比
┌─────────────────┬─────────────────┐
│   原始图片       │   修复后         │
│                 │                 │
│   [Canvas 1]    │   [Canvas 2]    │
│                 │                 │
└─────────────────┴─────────────────┘
      [切换显示模式]
B. 滑动对比（擦除式）
┌─────────────────────────────────┐
│  原始 ║ 修复后                    │
│       ║                          │
│       ║← 拖动滑块对比             │
│       ║                          │
└─────────────────────────────────┘

3.3.2 交互功能

同步浏览：双图同步缩放和平移（Canvas事件监听）
对比模式切换：左右对比 / 滑块擦除 / 上下对比
全屏查看：Fullscreen API 全屏对比
下载功能：Canvas.toBlob() 导出图片

3.3.3 页面实现（comparison.html）

组件结构：ComparisonPage 包含 ModeSwitch、SplitView、SliderView、ZoomTool
分屏模式：两个Canvas元素，使用CSS Grid布局
滑块模式：react-image-comparison-slider 或自定义实现（clip-path切割）
工具栏：模式切换、缩放控制、全屏、下载按钮
性能优化：使用 OffscreenCanvas 提前渲染大图


3.4 效果评估模块
3.4.1 定量评估指标（简化版，适合浏览器计算）
A. 基础质量指标

平均亮度变化

计算图像整体亮度提升/降低
显示：原始亮度 → 修复后亮度


对比度变化

计算像素值的标准差
对比度越高，标准差越大


颜色丰富度

计算RGB三通道的分布均衡性
色彩越丰富，数值越高


清晰度指标

计算图像梯度（边缘强度）
清晰度越高，梯度越大



B. 简化的视觉质量评分

综合评分：0-100分

亮度合理性：20分
对比度：25分
颜色自然度：30分
清晰度：25分



3.4.2 可视化分析

直方图对比

显示修复前后的RGB直方图
使用ECharts绘制


参数对比表格

显示关键指标的变化百分比
正向变化显示为绿色，负向为红色



3.4.3 评估报告生成
简化报告内容：
╔══════════════════════════════════════╗
║      图像修复质量报告                  ║
╠══════════════════════════════════════╣
║ 📋 基本信息                          ║
║    文件名：summer_beach.jpg           ║
║    处理时间：2025-11-30 14:30         ║
║    修复耗时：1.2秒                    ║
║                                      ║
║ 📊 质量改善                          ║
║    ┌─────────┬──────┬──────┬──────┐ ║
║    │ 指标    │ 原始 │ 修复 │ 变化 │ ║
║    ├─────────┼──────┼──────┼──────┤ ║
║    │ 亮度    │ 45   │ 68   │+51%  │ ║
║    │ 对比度  │ 0.35 │ 0.58 │+66%  │ ║
║    │ 清晰度  │ 4.2  │ 7.8  │+86%  │ ║
║    │ 综合评分│ 52   │ 82   │+30   │ ║
║    └─────────┴──────┴──────┴──────┘ ║
║                                      ║
║ ✨ 修复效果                          ║
║    ✓ 照片整体更明亮                  ║
║    ✓ 对比度显著提升                  ║
║    ✓ 细节更清晰可见                  ║
║                                      ║
║ [下载修复图] [保存报告]               ║
╚══════════════════════════════════════╝
3.4.4 报告页面实现（report.html）

布局：ReportPage 包含 BasicInfo、MetricsTable、HistogramChart、ActionBar
数据计算：Web Worker 后台计算各项指标
图表渲染：ECharts 绘制直方图和雷达图
报告导出：

使用 html2canvas 将报告区域转为图片
或使用 jsPDF 生成PDF（可选）
Canvas.toBlob() 下载修复后的图片




1. 数据流设计
4.1 主流程数据流（纯浏览器端）
用户选择文件 → File API读取
                    ↓
            Canvas绘制原图
                    ↓
            提取ImageData
                    ↓
        Web Worker处理
         ├─ 颜色校正
         ├─ 对比度增强
         └─ 去噪处理
                    ↓
        返回新ImageData
                    ↓
        Canvas渲染修复图
                    ↓
    ┌──────────┴──────────┐
    ↓                     ↓
IndexedDB保存         质量评估
    ↓                     ↓
历史记录              生成报告
    ↓                     ↓
用户下载              结果展示
4.2 本地存储结构（IndexedDB）
javascript// 数据库结构设计
{
  database: "ImageRestoration",
  version: 1,
  stores: [
    {
      name: "images",        // 图像存储
      keyPath: "id",
      indexes: [
        { name: "timestamp", keyPath: "timestamp" },
        { name: "type", keyPath: "type" }
      ],
      data: {
        id: "uuid",
        originalBlob: Blob,    // 原始图像
        processedBlob: Blob,   // 修复后图像
        fileName: "string",
        fileSize: number,
        dimensions: {width, height},
        timestamp: Date,
        type: "water|lowlight|dehaze|old-photo|daily"
      }
    },
    {
      name: "presets",       // 用户预设
      keyPath: "id",
      data: {
        id: "uuid",
        name: "string",
        parameters: {
          colorTemp: number,
          saturation: number,
          contrast: number,
          sharpness: number,
          denoising: number
        },
        createTime: Date
      }
    },
    {
      name: "history",       // 处理历史
      keyPath: "id",
      data: {
        id: "uuid",
        imageId: "uuid",     // 关联到images表
        parameters: Object,
        metrics: Object,     // 质量指标
        timestamp: Date
      }
    }
  ]
}
```

---

## 5. 用户界面设计

### 5.1 页面结构与导航
- `UI设计/index.html`：多卡片式仪表板，承载首页导航、处理统计和最近历史。
- `UI设计/upload.html`：独立上传页，负责多文件拖拽、格式提示和批量预览。
- `UI设计/adjustment.html`：参数调节工作台，展示原始/修复对比与多组滑块。
- `UI设计/comparison.html`：深色主题对比页，提供分屏/滑块/。
- `UI设计/report.html`：质量评估报告页，输出指标、表格与导出操作。

### 5.2 主仪表板（index.html）
- 顶部 Header 使用 135° 渐变背景，左侧为标题与 emoji 图标，右侧提供「设置/帮助/退出」操作按钮。
- 欢迎 Banner 展示用户称呼与当天日期，可替换文案以突出“多场景图像修复工具”而非单一用途。
- 「Quick actions」网格容纳上传、自动修复、手动调整、批量处理等入口，每个卡片包含图标、描述和渐变按钮。
- 「Stats grid」用彩色顶边卡片展示累计处理量、平均质量提升、总处理时间等指标，突出系统价值。
- 「Recent section」列表列出最近处理记录，含文件名、时间、尺寸、状态标签；支持扩展 type 标签（夜景/雾霾等）。

### 5.3 上传页（upload.html）
- 页面以居中对齐的卡片式布局呈现，顶部标题+副标题引导用户拖拽或点击上传。
- 核心「upload-area」采用虚线边框、渐变背景与大图标提示，支持拖拽、点击和文件夹选择；info box 用于提示最佳素材类型（文案后续将覆盖多场景说明）。
- 允许批量文件，预览区 `preview-grid` 会以正方形卡片展示缩略图、悬浮删除按钮和空状态提示。
- 页面底部提供「开始修复 / 清空重置」按钮组，并对上传格式（JPG/PNG/BMP/TIFF）与 100MB 限制进行文案提示。

### 5.4 手动调整页（adjustment.html）
- 两列布局：左侧为主内容区（原图/修复预览 + 参数面板），右侧为侧栏信息（文件信息、快捷操作、建议）。
- 预览区使用双 Canvas 卡片，加上角标标识“原始图像/修复预览”，可扩展为滑块对比或同步缩放。
- 参数面板按功能块（颜色校正、对比度增强、去散射去噪）组织，每个 slider 都有当前值和文字说明；配合 debounce 与 Web Worker 触发重新渲染。
- 「快速预设」区域提供按钮组，当前 HTML 展示“浅水/深水/浑浊/自定义/重置/保存”示例，实际实现中将拓展为“/夜景/雾霾/老照片/日常”等多场景模板。
- 侧栏信息卡展示文件名、分辨率、文件大小、处理耗时，以及应用修复/全屏预览/对比详情等操作与建议文案。

### 5.5 效果对比页（comparison.html）
- 深色背景突出图片，顶部 header 集成模式切换按钮（分屏/滑动/局部放大）。
- 分屏模式：两列布局+彩色角标，适合对齐查看；滑动模式：clip-path+center handle 形成擦除效果；
- 页面下方包含统计卡，展示 UIQM、UCIQE、清晰度、处理耗时等指标，并有保存、查看报告、返回首页的按钮组。

### 5.6 质量评估报告页（report.html）
- 报告头部卡片提供标题、处理时间、文件名、分辨率、耗时等基础信息，采用大圆角和阴影。
- 「定量评估指标」区用 `metrics-grid` 卡片表示 UIQM/UCIQE/信息熵/平均梯度等数值，附带进度条和提升百分比。
- 表格部分涵盖指标对比、颜色质量分析、主观评价等，同时有柱状条、建议列表和导出按钮（PDF/图像/返回）。
- 文案虽以“”示例编写，但结构与样式适用于所有场景，可根据 `type` 字段动态替换描述和结论。

### 5.7 交互流程与状态反馈
- 首页→上传→手动调整/自动修复→对比→报告的流程在以上 HTML 中完整体现；每个页面都保留主操作按钮（如“开始修复”“应用修复”“保存修复图像”“查看详细报告”）。
- 上传区 hover/drag 状态、预览卡的删除按钮、slider hover 效果、模式切换 active 状态等均在 HTML/CSS 中实现，可直接移植到 React 组件。
- 动画与反馈：卡片 hover 上浮、按钮渐变、info box/tooltip 提示等用纯 CSS 完成，不依赖额外库。

### 5.8 响应式与主题
- 所有页面使用 `grid-template-columns: repeat(auto-fit, minmax(...))` 或媒体查询 (`@media (max-width:768px)`) 控制断点，上传/调整/对比/报告页面均提供一列布局降级策略。
- 渐变主题色统一为 `#667eea → #764ba2`，辅以成功/警告等强调色；暗色对比页使用 `#1a1a1a` 背景，保证图片聚焦。
- 字体统一使用系统 UI 字体族（-apple-system, Segoe UI, Roboto 等），图标主要通过 emoji 与按钮文案搭配实现，无需额外矢量库。


6. 性能优化策略
6.1 图像处理优化

多线程处理

使用Web Workers处理图像数据
避免阻塞主线程，保持界面流畅


分辨率自适应

预览时使用缩小版本（如宽度800px）
最终导出使用原始分辨率
自动检测浏览器性能，动态调整


增量处理

参数调整时，只重新计算变化的部分
使用debounce延迟处理（300ms）


内存管理

及时清理不用的ImageData
限制历史记录数量（默认保留最近20条）
大图片使用OffscreenCanvas



6.2 加载优化

代码分割

按页面懒加载组件
算法库按需引入


资源缓存

Service Worker缓存静态资源
IndexedDB缓存图像数据


渐进式加载

骨架屏占位
图片懒加载
优先加载关键功能




7. 浏览器兼容性
7.1 目标浏览器（Windows系统）
主要支持：

Chrome 90+（推荐）
Edge 90+（推荐）
Firefox 88+

最低要求：

支持Canvas API
支持Web Workers
支持IndexedDB
支持ES6+语法

7.2 功能降级方案
功能降级方案Web Workers不支持主线程处理（可能卡顿）IndexedDB不支持使用LocalStorageOffscreenCanvas不支持使用普通CanvasService Worker不支持仅在线使用



8.2 使用技巧
💡 照片：

色温：+30（偏暖）
饱和度：140%
对比度：130%
去雾：60%

💡 夜景照片：

亮度：+40
对比度：120%
去噪：40%
锐化：30%

💡 雾霾照片：

去雾：80%
对比度：140%
饱和度：110%

💡 老照片：

色温：-10（偏冷）
对比度：150%
去噪：60%
锐化：40%

💡 日常照片：

亮度：+15
饱和度：115%
对比度：110%
去噪：20%（保证纯净背景）
